# 🧪 테스트 체크리스트

내일 아침 확인용 최종 검증 체크리스트입니다.

## ✅ 사전 준비

### 1. 환경변수 설정
```bash
# .env 파일 생성
cp .env.example .env
```

다음 값들을 반드시 설정하세요:
- [ ] `NEXT_PUBLIC_SUPABASE_URL`
- [ ] `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- [ ] `SUPABASE_SERVICE_ROLE_KEY`
- [ ] `NEXT_PUBLIC_KAKAO_MAP_APP_KEY`
- [ ] `NEXT_PUBLIC_APP_URL` (http://localhost:3000)

### 2. 의존성 설치
```bash
npm install
```

### 3. Supabase 설정
- [ ] Supabase 프로젝트 생성
- [ ] SQL Editor에서 `supabase/migrations/20240101000000_initial_schema.sql` 실행
- [ ] API 키 복사

### 4. Kakao Developers 설정
- [ ] 애플리케이션 생성
- [ ] Web 플랫폼 등록 (http://localhost:3000)
- [ ] JavaScript 키 복사

## 🧪 기능별 테스트

### 1. 부고장 생성 (/create)

#### 테스트 시나리오
1. [ ] 메인 페이지(/)에서 템플릿 선택
2. [ ] 모든 필수 필드 입력
   - 고인명: "테스트 고인"
   - 별세일시: 오늘 날짜
   - 장례식장: "서울아산병원 장례식장"
   - 발인일시: 내일 날짜
   - 상주명: "테스트 상주"
   - 전화번호: "010-1234-5678"
   - 비밀번호: "test1234"
3. [ ] 선택 필드 입력 (계좌정보 포함)
4. [ ] "부고장 만들기" 버튼 클릭
5. [ ] 부고장 상세 페이지로 리다이렉트 확인

#### 예상 결과
- ✅ 폼 유효성 검증 동작
- ✅ 부고장 생성 성공
- ✅ UUID 기반 URL 생성
- ✅ 30건 제한 확인 (rate limiting)

### 2. 부고장 조회 (/notice/[id])

#### 테스트 시나리오
1. [ ] 생성된 부고장 URL 접속
2. [ ] 템플릿 디자인 확인
3. [ ] 입력한 정보 표시 확인
4. [ ] 계좌정보 표시 여부 확인
5. [ ] 지도 로딩 확인 (Kakao Maps)
6. [ ] 공유 버튼 클릭
   - [ ] 카카오톡 공유
   - [ ] 문자 공유
   - [ ] 링크 복사

#### 예상 결과
- ✅ 모든 정보가 올바르게 표시됨
- ✅ 지도가 정상적으로 로드됨
- ✅ 공유 기능 동작

### 3. 관리자 로그인 (/owner/[id]/login)

#### 테스트 시나리오
1. [ ] 부고장 상세 페이지에서 "관리하기" 버튼 클릭
2. [ ] 생성 시 사용한 전화번호 입력: "010-1234-5678"
3. [ ] 생성 시 사용한 비밀번호 입력: "test1234"
4. [ ] 로그인 버튼 클릭
5. [ ] 관리 페이지로 리다이렉트 확인

#### 실패 테스트
- [ ] 잘못된 전화번호 입력 → 에러 메시지
- [ ] 잘못된 비밀번호 5회 입력 → 계정 잠금 메시지
- [ ] 10분 후 재시도 가능 확인

#### 예상 결과
- ✅ 정상 로그인 성공
- ✅ 세션 쿠키 설정
- ✅ 로그인 제한 동작

### 4. 부고장 수정 (/owner/[id]/manage)

#### 테스트 시나리오
1. [ ] 로그인 후 관리 페이지 접속
2. [ ] 고인 정보 수정 (향년 변경)
3. [ ] 계좌 정보 수정
4. [ ] 공개 여부 토글 (연락처/계좌)
5. [ ] "변경사항 저장" 버튼 클릭
6. [ ] 부고장 상세 페이지로 이동
7. [ ] 수정된 내용 확인

#### 예상 결과
- ✅ 수정 성공
- ✅ 변경사항이 즉시 반영됨

### 5. 부고장 삭제

#### 테스트 시나리오
1. [ ] 관리 페이지에서 "부고장 삭제" 버튼 클릭
2. [ ] 확인 메시지 확인
3. [ ] 확인 버튼 클릭
4. [ ] 메인 페이지로 리다이렉트 확인
5. [ ] 삭제된 부고장 URL 접속 → 404 에러

#### 예상 결과
- ✅ Soft delete (is_active = false)
- ✅ 접근 불가

## 🔒 보안 테스트

### 1. 인증 검증
- [ ] 로그인 없이 `/owner/[id]/manage` 접속 → 401 에러
- [ ] 다른 부고장 ID로 수정 시도 → 401 에러
- [ ] 세션 만료 후 접속 → 로그인 페이지로 리다이렉트

### 2. Rate Limiting
```bash
# 30번 이상 부고장 생성 시도
for i in {1..31}; do
  curl -X POST http://localhost:3000/api/notices \
    -H "Content-Type: application/json" \
    -d '{...}'
done
```
- [ ] 31번째 요청에서 429 에러 확인

### 3. SQL Injection 방지
- [ ] 특수문자 입력 테스트 (`' OR '1'='1`)
- [ ] Supabase RLS 정책 동작 확인

## 📱 모바일 테스트

### 반응형 디자인
- [ ] 모바일 브라우저에서 접속
- [ ] 템플릿 선택 화면 확인
- [ ] 부고장 생성 폼 확인
- [ ] 부고장 조회 화면 확인
- [ ] 공유 버튼 동작 확인

### 공유 기능
- [ ] 카카오톡 앱으로 공유
- [ ] 문자 앱 실행
- [ ] 웹 공유 API 동작

## 🌐 브라우저 호환성

### Chrome
- [ ] 모든 기능 정상 동작

### Safari (iOS)
- [ ] 모든 기능 정상 동작
- [ ] 카카오톡 공유 동작
- [ ] 쿠키 설정 확인

### Samsung Internet
- [ ] 모든 기능 정상 동작

## 🐛 알려진 문제 및 제한사항

### 현재 구현되지 않은 기능
- ❌ hCaptcha (스팸 방지) - 환경변수만 설정됨
- ❌ 카카오맵 Geocoding (주소 → 좌표) - 클라이언트에서 처리해야 함
- ❌ OG 이미지 동적 생성 - placeholder만 있음
- ❌ Analytics 연동 - 환경변수만 설정됨

### 주의사항
1. **Kakao Maps API**
   - 등록된 도메인에서만 동작
   - localhost:3000을 반드시 등록하세요

2. **Supabase RLS**
   - Service Role Key는 서버에서만 사용
   - 클라이언트에 노출되면 안 됨

3. **세션 쿠키**
   - HttpOnly, SameSite 설정
   - HTTPS 환경에서만 Secure 플래그 활성화

4. **Rate Limiting**
   - IP 기반 제한
   - 로컬 테스트 시 동일 IP로 카운트됨

## 🚀 배포 전 체크리스트

### Vercel 배포
- [ ] 환경변수 모두 설정
- [ ] `NEXT_PUBLIC_APP_URL` 프로덕션 도메인으로 변경
- [ ] Kakao Developers에 프로덕션 도메인 등록
- [ ] Supabase 프로덕션 인스턴스 설정

## ✅ 최종 검증

모든 테스트 통과 시:
```bash
# 빌드 테스트
npm run build

# 타입 체크
npm run type-check

# 린트 체크
npm run lint
```

## 📞 문제 발생 시 체크사항

### 1. "Kakao Maps API not loaded"
- Kakao Developers에서 도메인 등록 확인
- JavaScript 키 확인
- 브라우저 콘솔에서 스크립트 로딩 확인

### 2. "Supabase error"
- 환경변수 확인
- SQL 마이그레이션 실행 확인
- Supabase 대시보드에서 테이블 생성 확인

### 3. "Login failed"
- 전화번호 형식 확인 (010-xxxx-xxxx)
- 비밀번호 8자 이상 확인
- 계정 잠금 여부 확인 (5회 실패)

### 4. "Rate limit exceeded"
- 24시간 대기 또는
- Supabase에서 rate_limits 테이블 수동 삭제

## 🎯 성공 기준

- ✅ 부고장 생성부터 삭제까지 전체 플로우 동작
- ✅ 인증 및 세션 관리 정상 동작
- ✅ 카카오맵 및 공유 기능 정상 동작
- ✅ 보안 기능 (rate limiting, 계정 잠금) 동작
- ✅ 빌드 및 타입 체크 통과
- ✅ 모바일 반응형 정상 동작

---

**모든 체크리스트 완료 시: 프로덕션 배포 준비 완료! 🚀**
